"use strict";(()=>{var e={};e.id=198,e.ids=[198],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},8893:e=>{e.exports=require("buffer")},4770:e=>{e.exports=require("crypto")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},6162:e=>{e.exports=require("stream")},1764:e=>{e.exports=require("util")},5398:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>g,patchFetch:()=>v,requestAsyncStorage:()=>f,routeModule:()=>m,serverHooks:()=>x,staticGenerationAsyncStorage:()=>E});var s={};t.r(s),t.d(s,{POST:()=>d});var o=t(9303),n=t(8716),i=t(670),a=t(7070),u=t(9178),p=t(629),l=t(5315);let c={"application/pdf":"pdf","image/jpeg":"jpg","image/jpg":"jpg","image/png":"png","image/gif":"gif"};async function d(e){try{let r=(0,u.AY)(e);if(!r)return a.NextResponse.json({error:"Authentication required"},{status:401});if("purchaser"!==r.role&&"ceo"!==r.role)return a.NextResponse.json({error:"Insufficient permissions to upload files"},{status:403});let s=(await e.formData()).get("file");if(!s)return a.NextResponse.json({error:"No file uploaded"},{status:400});if(s.size>10485760)return a.NextResponse.json({error:"File size exceeds 10MB limit"},{status:400});if(!c[s.type])return a.NextResponse.json({error:"Invalid file type. Allowed: PDF, JPG, PNG, GIF"},{status:400});let o=Date.now(),n=c[s.type],i=`cost-proof-${o}-${Math.random().toString(36).substr(2,9)}.${n}`,d=await s.arrayBuffer(),m=Buffer.from(d),f=(0,l.join)(process.cwd(),"public","uploads","cost-proofs");try{let{mkdir:e}=await Promise.resolve().then(t.t.bind(t,629,23));await e(f,{recursive:!0})}catch(e){}let E=(0,l.join)(f,i);await (0,p.writeFile)(E,m);let x=`/uploads/cost-proofs/${i}`;return a.NextResponse.json({success:!0,filename:i,url:x,type:n,size:s.size})}catch(e){return console.error("File upload error:",e),a.NextResponse.json({error:"Failed to upload file"},{status:500})}}let m=new o.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/uploads/route",pathname:"/api/uploads",filename:"route",bundlePath:"app/api/uploads/route"},resolvedPagePath:"C:\\Users\\Naam\\Documents\\Procurement_App\\app\\api\\uploads\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:E,serverHooks:x}=m,g="/api/uploads/route";function v(){return(0,i.patchFetch)({serverHooks:x,staticGenerationAsyncStorage:E})}},9178:(e,r,t)=>{t.d(r,{AY:()=>p,LC:()=>u,LX:()=>i,Rf:()=>c,rm:()=>a,y$:()=>l,y7:()=>d});var s=t(1482),o=t.n(s);let n=process.env.JWT_SECRET||"fallback-secret-change-in-production";function i(e){let r=process.env.CEO_EMAILS?.split(",").map(e=>e.trim())||[],t=process.env.PURCHASER_EMAILS?.split(",").map(e=>e.trim())||[],s=process.env.EXTERNAL_REQUESTER_EMAILS?.split(",").map(e=>e.trim())||[];return!!(r.includes(e)||t.includes(e)||s.includes(e)||e.endsWith("@batiamosa.be"))}function a(e){if(!i(e))return null;let r=process.env.CEO_EMAILS?.split(",").map(e=>e.trim())||[],t=process.env.PURCHASER_EMAILS?.split(",").map(e=>e.trim())||[],s=process.env.EXTERNAL_REQUESTER_EMAILS?.split(",").map(e=>e.trim())||[];return r.includes(e)?"ceo":t.includes(e)?"purchaser":s.includes(e)||e.endsWith("@batiamosa.be")?"requester":null}function u(e){let r=Math.floor(Date.now()/1e3)+28800,t={id:e.id,email:e.email,role:e.role,name:e.name,type:"session",exp:r};return o().sign(t,n)}function p(e){let r=e.cookies.get("session-token")?.value;return r?function(e){try{let r=o().verify(e,n);if("session"!==r.type)return null;return{id:r.id,email:r.email,role:r.role,name:r.name}}catch(e){return null}}(r):null}function l(e){return`session-token=${e}; HttpOnly; Secure; SameSite=Lax; Max-Age=28800; Path=/`}function c(){return"session-token=; HttpOnly; Secure; SameSite=Lax; Max-Age=0; Path=/"}function d(e){let r=a(e);return r?{id:`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,email:e,role:r,name:e.split("@")[0]}:null}process.env.MAGIC_LINK_SECRET,process.env.JWT_EXPIRES_IN,process.env.MAGIC_LINK_EXPIRES_IN}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,482],()=>t(5398));module.exports=s})();