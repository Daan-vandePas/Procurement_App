(()=>{var e={};e.id=52,e.ids=[52],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},1576:(e,t,s)=>{"use strict";s.r(t),s.d(t,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o}),s(6932),s(9561),s(5866);var r=s(3191),a=s(8716),i=s(7922),l=s.n(i),d=s(5231),n={};for(let e in d)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>d[e]);s.d(t,n);let o=["",{children:["requests",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,6932)),"C:\\Users\\Naam\\Documents\\Procurement_App\\app\\requests\\[id]\\page.tsx"]}]},{}]},{}]},{layout:[()=>Promise.resolve().then(s.bind(s,9561)),"C:\\Users\\Naam\\Documents\\Procurement_App\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Naam\\Documents\\Procurement_App\\app\\requests\\[id]\\page.tsx"],m="/requests/[id]/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/requests/[id]/page",pathname:"/requests/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},3959:(e,t,s)=>{Promise.resolve().then(s.bind(s,579))},2440:(e,t,s)=>{Promise.resolve().then(s.bind(s,7802))},8555:(e,t,s)=>{Promise.resolve().then(s.t.bind(s,2994,23)),Promise.resolve().then(s.t.bind(s,6114,23)),Promise.resolve().then(s.t.bind(s,9727,23)),Promise.resolve().then(s.t.bind(s,9671,23)),Promise.resolve().then(s.t.bind(s,1868,23)),Promise.resolve().then(s.t.bind(s,4759,23))},7802:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>o});var r=s(326),a=s(7577),i=s(5047),l=s(434);function d({items:e,onItemUpdate:t,onSubmitForApproval:s,processingItems:i,setProcessingItems:l,isSubmitting:d,uploadingFile:n,setUploadingFile:o}){let[c,m]=(0,a.useState)({}),[u,x]=(0,a.useState)({}),[p,h]=(0,a.useState)({}),g=(e,t,s)=>{let r={...i[e]||{itemStatus:"pending"},[t]:s};if(l({...i,[e]:r}),c[e]){let t={...c};delete t[e],m(t)}},j=async(e,t)=>{o(e);try{let s=new FormData;s.append("file",t);let r=await fetch("/api/uploads",{method:"POST",body:s}),a=await r.json();if(!r.ok||!a.success)throw Error(a.error||"Upload failed");let d=a.url||a.blobUrl;if(!d)throw Error("Upload succeeded but no file URL returned");let n={...i[e]||{itemStatus:"pending"},costProof:d,costProofType:"pdf"===a.type?"pdf":"image"};l({...i,[e]:n}),x({...u,[e]:""})}catch(t){m({...c,[e]:t instanceof Error?t.message:"Upload failed"})}finally{o(null)}},b=async e=>{let s=i[e];if(!s)return;let r="";if("rejected"===s.itemStatus?s.rejectionReason?.trim()||(r="Rejection reason is required"):"priced"!==s.itemStatus||(!s.actualCost||s.actualCost<=0?r="Actual cost must be greater than 0":s.costProof?.trim()||(r="Cost proof is required")),r){m({...c,[e]:r});return}try{await t({itemId:e,data:s}),m({...c,[e]:""}),h({...p,[e]:!1})}catch(t){m({...c,[e]:t instanceof Error?t.message:"Failed to save item"})}},f=e=>{switch(e){case"priced":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}};return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-blue-900",children:"Processing Progress"}),(0,r.jsxs)("p",{className:"text-sm text-blue-700",children:[e.filter(e=>{let t=i[e.id];return t&&"pending"!==t.itemStatus}).length," of ",e.length," items processed"]})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("div",{className:"w-32 bg-blue-200 rounded-full h-2 mr-3",children:r.jsx("div",{className:"bg-blue-600 h-2 rounded-full transition-all",style:{width:`${e.filter(e=>{let t=i[e.id];return t&&"pending"!==t.itemStatus}).length/e.length*100}%`}})}),(0,r.jsxs)("span",{className:"text-sm font-medium text-blue-900",children:[Math.round(e.filter(e=>{let t=i[e.id];return t&&"pending"!==t.itemStatus}).length/e.length*100),"%"]})]})]})}),r.jsx("div",{className:"space-y-4",children:e.map((e,t)=>{let s=i[e.id]||{itemStatus:"pending"},a=c[e.id],d=!!s.actualCost&&s.actualCost>0,o=!!s.costProof&&"undefined"!==s.costProof&&s.costProof.toString().trim().length>0,m=n===e.id,h="pending"!==s.itemStatus;return p[e.id],(0,r.jsxs)("div",{className:`bg-white border rounded-lg p-6 ${h?"border-green-200 bg-green-50":"border-gray-200"}`,children:[(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-lg font-medium text-gray-900",children:["Item ",t+1,": ",e.itemName]}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:["Quantity: ",e.quantity," | Estimated: €",e.estimatedCost]})]}),r.jsx("span",{className:`px-3 py-1 text-sm font-medium rounded-full ${f(s.itemStatus)}`,children:s.itemStatus})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Option 1: Add Pricing"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost for total Quantity (€)"}),r.jsx("input",{type:"number",step:"0.01",min:"0",value:s.actualCost||"",onChange:t=>g(e.id,"actualCost",parseFloat(t.target.value)||void 0),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"0.00"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Name"}),r.jsx("input",{type:"text",value:s.supplierName||"",onChange:t=>g(e.id,"supplierName",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Enter supplier name"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Supplier Reference (Optional)"}),r.jsx("input",{type:"text",value:s.supplierReference||"",onChange:t=>g(e.id,"supplierReference",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Part number, SKU, or supplier reference"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Cost Proof"}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[r.jsx("input",{type:"file",accept:".pdf,.jpg,.jpeg,.png,.gif",onChange:t=>{let s=t.target.files?.[0];s&&j(e.id,s)},className:"block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100",disabled:n===e.id}),n===e.id&&r.jsx("p",{className:"text-sm text-blue-600",children:"Uploading..."})]}),r.jsx("div",{children:r.jsx("input",{type:"url",value:u[e.id]||"",onChange:t=>{let s=t.target.value;x({...u,[e.id]:s});let r={...i[e.id]||{itemStatus:"pending"},costProof:s,costProofType:s?"link":void 0};l({...i,[e.id]:r})},className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Or paste a link to cost proof"})}),s.costProof&&(0,r.jsxs)("p",{className:"text-sm text-green-600",children:["✓ Cost proof: ","link"===s.costProofType?"Link":"File"," uploaded"]})]})]}),r.jsx("button",{onClick:async()=>{try{g(e.id,"itemStatus","priced"),await new Promise(e=>setTimeout(e,50)),await b(e.id)}catch(e){console.error("Error saving priced item:",e)}},disabled:!(d&&o&&!m),className:"w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 disabled:opacity-50 disabled:cursor-not-allowed",children:m?"Uploading File...":`Save Pricing ${d?o?"✓":"(Missing Proof)":"(Missing Cost)"}`})]}),(0,r.jsxs)("div",{className:"space-y-4",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-700",children:"Option 2: Reject Item"}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason"}),r.jsx("textarea",{value:s.rejectionReason||"",onChange:t=>g(e.id,"rejectionReason",t.target.value),rows:4,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-blue-500 focus:border-blue-500",placeholder:"Explain why this item is being rejected..."})]}),r.jsx("button",{onClick:async()=>{g(e.id,"itemStatus","rejected"),setTimeout(()=>b(e.id),100)},disabled:!s.rejectionReason?.trim(),className:"w-full bg-red-600 text-white py-2 px-4 rounded-md hover:bg-red-700 disabled:opacity-50 disabled:cursor-not-allowed",children:"Reject Item"})]})]}),a&&r.jsx("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:r.jsx("p",{className:"text-sm text-red-700",children:a})})]},e.id)})}),null===n&&e.every(e=>{let t=i[e.id];return t&&"pending"!==t.itemStatus})&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-6",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-green-900",children:"Ready for Approval"}),r.jsx("p",{className:"text-sm text-green-700",children:"All items have been processed. You can now submit this request for approval."})]}),r.jsx("button",{onClick:s,disabled:d||null!==n,className:"bg-green-600 text-white py-3 px-6 rounded-md hover:bg-green-700 disabled:opacity-50 font-medium",children:d?"Submitting...":n?"Uploading files...":"Submit for Approval"})]})})]})}function n({items:e,onItemUpdate:t,onCompleteReview:s,approvalItems:i,setApprovalItems:l,isSubmitting:d}){let[n,o]=(0,a.useState)({}),[c,m]=(0,a.useState)({}),[u,x]=(0,a.useState)({}),p=e=>{m({...c,[e]:!c[e]})},h=(e,t,s)=>{let r={...i[e]||{approvalStatus:"pending_approval"},[t]:s};if(l({...i,[e]:r}),n[e]){let t={...n};delete t[e],o(t)}},g=async(e,s)=>{if("reject"===s){x({...u,[e]:!0});return}try{let r;if(r="approve"===s?{approvalStatus:"approved",approvedBy:"CEO",approvedDate:new Date().toISOString()}:{approvalStatus:"pending_approval"},await t({itemId:e,data:r}),x({...u,[e]:!1}),n[e]){let t={...n};delete t[e],o(t)}}catch(t){o({...n,[e]:t instanceof Error?t.message:"Failed to update approval status"})}},j=async e=>{try{let s=i[e]?.ceoRejectionReason?.trim();if(!s){o({...n,[e]:"Rejection reason is required when rejecting an item"});return}let r={approvalStatus:"rejected",ceoRejectionReason:s,approvedBy:"CEO",approvedDate:new Date().toISOString()};if(await t({itemId:e,data:r}),x({...u,[e]:!1}),n[e]){let t={...n};delete t[e],o(t)}}catch(t){o({...n,[e]:t instanceof Error?t.message:"Failed to reject item"})}},b=e=>{switch(e){case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},f=()=>e.every(e=>{let t=i[e.id]?.approvalStatus||e.approvalStatus;return"approved"===t||"rejected"===t}),y=async()=>{if(!f()){o({...n,general:"Please review all items before completing the approval process"});return}try{await s()}catch(e){o({...n,general:e instanceof Error?e.message:"Failed to complete review"})}},v=(()=>{let t=e.filter(e=>"approved"===(i[e.id]?.approvalStatus||e.approvalStatus)).length,s=e.filter(e=>"rejected"===(i[e.id]?.approvalStatus||e.approvalStatus)).length,r=e.length-t-s;return{approved:t,rejected:s,pending:r}})();return(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx("svg",{className:"w-5 h-5 text-blue-400 mr-3",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("div",{className:"flex-1",children:(0,r.jsxs)("p",{className:"text-sm font-medium text-blue-800",children:["Review Progress: ",v.approved," approved, ",v.rejected," rejected, ",v.pending," pending"]})})]})}),r.jsx("div",{className:"space-y-4",children:e.map((e,t)=>{let s={approvalStatus:i[e.id]?.approvalStatus||e.approvalStatus||"pending_approval",ceoRejectionReason:i[e.id]?.ceoRejectionReason||e.ceoRejectionReason,approvedBy:i[e.id]?.approvedBy||e.approvedBy,approvedDate:i[e.id]?.approvedDate||e.approvedDate},a=c[e.id],l=n[e.id];return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg bg-white",children:[(0,r.jsxs)("div",{className:"p-4 border-b border-gray-100",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("button",{onClick:()=>p(e.id),className:"text-gray-400 hover:text-gray-600",children:r.jsx("svg",{className:`w-5 h-5 transform ${a?"rotate-90":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 5l7 7-7 7"})})}),(0,r.jsxs)("h3",{className:"text-base font-medium text-gray-900",children:["Item ",t+1,": ",e.itemName]})]}),r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${b(s.approvalStatus)}`,children:"pending_approval"===s.approvalStatus?"Pending Review":"approved"===s.approvalStatus?"Approved":"Rejected"})]}),(0,r.jsxs)("div",{className:"mt-4 flex space-x-3",children:[r.jsx("button",{onClick:()=>g(e.id,"approve"),disabled:d,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"approved"===s.approvalStatus?"bg-green-600 text-white":"bg-green-100 text-green-700 hover:bg-green-200 disabled:opacity-50"}`,children:"approved"===s.approvalStatus?"✓ Approved":"Approve"}),r.jsx("button",{onClick:()=>g(e.id,"reject"),disabled:d,className:`px-4 py-2 text-sm font-medium rounded-md transition-colors ${"rejected"===s.approvalStatus?"bg-red-600 text-white":"bg-red-100 text-red-700 hover:bg-red-200 disabled:opacity-50"}`,children:"rejected"===s.approvalStatus?"✗ Rejected":"Reject"}),"pending_approval"!==s.approvalStatus&&r.jsx("button",{onClick:()=>g(e.id,"pending"),disabled:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors disabled:opacity-50",children:"Reset to Pending"})]}),("rejected"===s.approvalStatus||u[e.id])&&(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Rejection Reason *"}),r.jsx("textarea",{value:i[e.id]?.ceoRejectionReason||"",onChange:t=>h(e.id,"ceoRejectionReason",t.target.value),placeholder:"Please provide a reason for rejecting this item...",rows:3,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none"}),"rejected"!==s.approvalStatus&&(0,r.jsxs)("div",{className:"mt-2 flex space-x-3",children:[r.jsx("button",{onClick:()=>j(e.id),disabled:d,className:"px-4 py-2 text-sm font-medium text-white bg-red-600 hover:bg-red-700 rounded-md transition-colors disabled:opacity-50",children:"Submit Rejection"}),r.jsx("button",{onClick:()=>x({...u,[e.id]:!1}),disabled:d,className:"px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-200 rounded-md transition-colors disabled:opacity-50",children:"Cancel"})]})]}),l&&r.jsx("div",{className:"mt-2 text-sm text-red-600",children:l})]}),a&&(0,r.jsxs)("div",{className:"p-4 bg-gray-50",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Request Details"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Quantity:"})," ",e.quantity]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Priority:"})," ",e.priority]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Estimated Cost:"})," €",e.estimatedCost]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Needed By:"})," ",new Date(e.neededByDate).toLocaleDateString()]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-2",children:"Purchaser Information"}),(0,r.jsxs)("div",{className:"space-y-1",children:[(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Supplier:"})," ",e.supplierName||"Not specified"]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Reference:"})," ",e.supplierReference||"Not specified"]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Actual Cost:"})," ",e.actualCost?`€${e.actualCost}`:"Not specified"]}),(0,r.jsxs)("p",{children:[r.jsx("span",{className:"text-gray-500",children:"Status:"}),r.jsx("span",{className:`ml-1 px-2 py-0.5 text-xs rounded-full ${"priced"===e.itemStatus?"bg-green-100 text-green-800":"rejected"===e.itemStatus?"bg-red-100 text-red-800":"bg-yellow-100 text-yellow-800"}`,children:e.itemStatus||"pending"})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Justification"}),r.jsx("p",{className:"text-gray-700",children:e.justification})]}),e.rejectionReason&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h4",{className:"font-medium text-red-800 mb-1",children:"Purchaser Rejection Reason"}),r.jsx("p",{className:"text-red-700 text-sm",children:e.rejectionReason})]}),e.costProof&&(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("h4",{className:"font-medium text-gray-900 mb-1",children:"Cost Proof"}),"link"===e.costProofType?r.jsx("a",{href:e.costProof,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm break-all",children:e.costProof}):r.jsx("a",{href:e.costProof,target:"_blank",rel:"noopener noreferrer",className:"text-blue-600 hover:underline text-sm",children:"View uploaded file"})]})]})]},e.id)})}),(0,r.jsxs)("div",{className:"flex justify-between items-center pt-6 border-t border-gray-200",children:[r.jsx("div",{children:n.general&&r.jsx("p",{className:"text-sm text-red-600",children:n.general})}),r.jsx("button",{onClick:y,disabled:!f()||d,className:`px-6 py-3 text-sm font-medium rounded-md transition-colors ${f()&&!d?"bg-blue-600 text-white hover:bg-blue-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,children:d?"Completing Review...":"Complete Review"})]})]})}function o(){let e=(0,i.useParams)(),t=(0,i.useRouter)(),s=e.id,[o,c]=(0,a.useState)(null),[m,u]=(0,a.useState)(null),[x,p]=(0,a.useState)(!0),[h,g]=(0,a.useState)(null),[j,b]=(0,a.useState)(!1),[f,y]=(0,a.useState)({}),[v,N]=(0,a.useState)(!1),[w,S]=(0,a.useState)(null),[P,R]=(0,a.useState)({}),q=async()=>{if(o&&confirm("Are you sure you want to delete this request? This action cannot be undone.")){b(!0);try{if(!(await fetch(`/api/requests/${o.id}`,{method:"DELETE"})).ok)throw Error("Failed to delete request");t.push("/requests")}catch(e){g(e instanceof Error?e.message:"Failed to delete request")}finally{b(!1)}}},C=async e=>{try{let t=await fetch(`/api/requests/${s}/process`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update item")}let r=await t.json();c(r)}catch(e){throw e}},k=async()=>{N(!0);try{let e=await fetch(`/api/requests/${s}/process`,{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to submit for approval")}let t=await e.json();c(t.request),g(null)}catch(e){g(e instanceof Error?e.message:"Failed to submit for approval")}finally{N(!1)}},_=async e=>{try{let t=await fetch(`/api/requests/${s}/approve`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok){let e=await t.json();throw Error(e.error||"Failed to update approval")}let r=await t.json();c(r);let a={};r.items.forEach(e=>{a[e.id]={approvalStatus:e.approvalStatus||"pending_approval",ceoRejectionReason:e.ceoRejectionReason,approvedBy:e.approvedBy,approvedDate:e.approvedDate}}),R(a)}catch(e){throw e}},D=async()=>{N(!0);try{let e=await fetch(`/api/requests/${s}/approve`,{method:"POST"});if(!e.ok){let t=await e.json();throw Error(t.error||"Failed to complete review")}let t=await e.json();c(t.request),g(null)}catch(e){g(e instanceof Error?e.message:"Failed to complete review")}finally{N(!1)}},E=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}},A=e=>{switch(e){case"priced":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-yellow-100 text-yellow-800"}},T=m?.role==="requester"&&o?.requesterName===m.email&&o?.status==="draft";m?.role==="requester"&&o?.requesterName===m.email&&o?.status;let U=m?.role==="purchaser"&&o?.status==="requested",$=m?.role==="ceo"&&o?.status==="waiting_for_approval";return x?r.jsx("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})}):h?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Request Details"}),r.jsx(l.default,{href:"/requests",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Requests"})]}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error loading request"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:h})]})]})})]}):o?(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Request Details"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Request ID: ",o.id]})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[r.jsx(l.default,{href:"/requests",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Requests"}),T&&(0,r.jsxs)(r.Fragment,{children:[r.jsx(l.default,{href:`/requests/${o.id}/edit`,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Edit Request"}),r.jsx("button",{onClick:q,disabled:j,className:"bg-red-600 text-white px-4 py-2 rounded-md hover:bg-red-700 transition-colors disabled:opacity-50",children:j?"Deleting...":"Delete Request"})]})]})]}),$&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Review Request Items"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review each item and approve or reject based on business requirements."})]}),r.jsx("div",{className:"p-6",children:r.jsx(n,{items:o.items,onItemUpdate:_,onCompleteReview:D,approvalItems:P,setApprovalItems:R,isSubmitting:v})})]}),!U&&!$&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Requester"}),(0,r.jsxs)("div",{className:"mt-1",children:[r.jsx("div",{className:"text-sm text-gray-900",children:o.requesterName.split("@")[0]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["@",o.requesterName.split("@")[1]]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Status"}),r.jsx("span",{className:`mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(e=>{switch(e){case"requested":return"bg-blue-100 text-blue-800";case"waiting_for_approval":return"bg-yellow-100 text-yellow-800";case"approved":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(o.status)}`,style:{whiteSpace:"pre-line",textAlign:"center"},children:"waiting_for_approval"===o.status?"Waiting for\nApproval":o.status.replace("_"," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Date Submitted"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(o.requestDate).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-4",children:"Requested Items"}),r.jsx("div",{className:"space-y-6",children:o.items.map((e,t)=>(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-4",children:[(0,r.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,r.jsxs)("h4",{className:"text-base font-medium text-gray-900",children:["Item ",t+1,": ",e.itemName]}),r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${E(e.priority)}`,children:e.priority})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Quantity"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:e.quantity})]}),Number(e.estimatedCost)>0&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Estimated Cost"}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:["€",e.estimatedCost]})]}),e.actualCost&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Actual Cost"}),(0,r.jsxs)("p",{className:"mt-1 text-sm text-gray-900",children:["€",e.actualCost]})]}),e.itemStatus&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Item Status"}),r.jsx("span",{className:`mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${A(e.itemStatus)}`,children:e.itemStatus})]}),e.supplierName&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Supplier"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:e.supplierName})]}),e.supplierReference&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Supplier Reference"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900 break-all",children:e.supplierReference})]}),e.neededByDate&&(0,r.jsxs)("div",{children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Needed By"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(e.neededByDate).toLocaleDateString()})]})]}),(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Justification"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:e.justification})]}),e.rejectionReason&&(0,r.jsxs)("div",{className:"mt-4 p-3 bg-red-50 border border-red-200 rounded-md",children:[r.jsx("h5",{className:"text-sm font-medium text-red-800",children:"Rejection Reason"}),r.jsx("p",{className:"mt-1 text-sm text-red-700",children:e.rejectionReason})]}),e.costProof&&(0,r.jsxs)("div",{className:"mt-4",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-500",children:"Cost Proof"}),"link"===e.costProofType?r.jsx("a",{href:e.costProof,target:"_blank",rel:"noopener noreferrer",className:"mt-1 text-sm text-blue-600 hover:underline break-all",children:e.costProof}):r.jsx("a",{href:e.costProof,target:"_blank",rel:"noopener noreferrer",className:"mt-1 text-sm text-blue-600 hover:underline",children:"View uploaded file"})]})]},e.id))})]})]}),U&&(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow",children:[(0,r.jsxs)("div",{className:"p-6 border-b border-gray-200",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Process Request Items"}),r.jsx("p",{className:"text-sm text-gray-600 mt-1",children:"Review each item and either add pricing information or reject the item."})]}),r.jsx("div",{className:"p-6",children:r.jsx(d,{items:o.items,onItemUpdate:C,onSubmitForApproval:k,processingItems:f,setProcessingItems:y,isSubmitting:v,uploadingFile:w,setUploadingFile:S})})]}),!T&&!U&&!$&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("div",{className:"ml-3",children:r.jsx("p",{className:"text-sm text-yellow-800",children:m?.role==="requester"&&"draft"!==o.status?"This request cannot be edited or deleted because it has already been submitted.":m?.role==="ceo"&&"waiting_for_approval"===o.status?"This request is waiting for your approval.":"This request is being processed."})})]})})]}):null}},579:(e,t,s)=>{"use strict";s.d(t,{default:()=>d});var r=s(326),a=s(7577),i=s(5047),l=s(434);function d({children:e}){let[t,s]=(0,a.useState)(null),[d,n]=(0,a.useState)(!0),o=(0,i.useRouter)(),c=(0,i.usePathname)(),m=["/login"].includes(c),u=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),s(null),o.push("/login?message=logged-out")}catch(e){}};return d&&!m?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):m||!t?r.jsx("div",{className:"min-h-screen bg-gray-50",children:e}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx(l.default,{href:(e=>{switch(e){case"ceo":case"purchaser":return"/requests";default:return"/"}})(t.role),className:"text-2xl font-semibold text-gray-900 hover:text-gray-700",children:"Procurement System"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("nav",{className:"flex space-x-4",children:(t?[{href:"/requests",label:"All Requests"}]:[]).map(e=>r.jsx(l.default,{href:e.href,className:`px-3 py-2 text-sm font-medium ${c===e.href?"text-blue-600 bg-blue-50 rounded-md":"text-gray-600 hover:text-gray-900"}`,children:e.label},e.href))}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 border-l pl-4",children:[(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"font-medium text-gray-900",children:t.name}),r.jsx("p",{className:"text-gray-500 capitalize",children:t.role})]}),r.jsx("button",{onClick:u,className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"Logout"})]})]})]})})}),r.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e})]})}},9561:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>l,metadata:()=>i});var r=s(9510);let a=(0,s(8570).createProxy)(String.raw`C:\Users\Naam\Documents\Procurement_App\components\AuthenticatedLayout.tsx#default`);s(7272);let i={title:"Procurement App",description:"Digital procurement request system for engineering teams"};function l({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"antialiased",children:r.jsx(a,{children:e})})})}},6932:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>r});let r=(0,s(8570).createProxy)(String.raw`C:\Users\Naam\Documents\Procurement_App\app\requests\[id]\page.tsx#default`)},7272:()=>{}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,982],()=>s(1576));module.exports=r})();