(()=>{var e={};e.id=182,e.ids=[182],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},3137:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>c,routeModule:()=>x,tree:()=>o}),t(3854),t(9561),t(5866);var r=t(3191),a=t(8716),i=t(7922),l=t.n(i),n=t(5231),d={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(d[e]=()=>n[e]);t.d(s,d);let o=["",{children:["purchaser",{children:["requests",{children:["[id]",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,3854)),"C:\\Users\\Naam\\Documents\\Procurement_App\\app\\purchaser\\requests\\[id]\\page.tsx"]}]},{}]},{}]},{}]},{layout:[()=>Promise.resolve().then(t.bind(t,9561)),"C:\\Users\\Naam\\Documents\\Procurement_App\\app\\layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,5866,23)),"next/dist/client/components/not-found-error"]}],c=["C:\\Users\\Naam\\Documents\\Procurement_App\\app\\purchaser\\requests\\[id]\\page.tsx"],m="/purchaser/requests/[id]/page",u={require:t,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/purchaser/requests/[id]/page",pathname:"/purchaser/requests/[id]",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},3959:(e,s,t)=>{Promise.resolve().then(t.bind(t,579))},2084:(e,s,t)=>{Promise.resolve().then(t.bind(t,4135))},8555:(e,s,t)=>{Promise.resolve().then(t.t.bind(t,2994,23)),Promise.resolve().then(t.t.bind(t,6114,23)),Promise.resolve().then(t.t.bind(t,9727,23)),Promise.resolve().then(t.t.bind(t,9671,23)),Promise.resolve().then(t.t.bind(t,1868,23)),Promise.resolve().then(t.t.bind(t,4759,23))},4135:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>n});var r=t(326),a=t(7577),i=t(5047),l=t(434);function n(){let e=(0,i.useParams)(),s=(0,i.useRouter)(),t=e.id,[n,d]=(0,a.useState)(null),[o,c]=(0,a.useState)(!0),[m,u]=(0,a.useState)(null),[x,p]=(0,a.useState)(!1),[h,g]=(0,a.useState)(!1),[f,b]=(0,a.useState)({}),y=(e,s,t)=>{b(r=>({...r,[e]:{...r[e],[s]:t}}))},j=(e,s)=>{s&&y(e,"attachments",Array.from(s).filter(e=>{let s="application/pdf"===e.type||e.type.startsWith("image/"),t=e.size<=10485760;return s&&t}))},N=async()=>{if(n){p(!0),g(!1);try{let e=n.items.map(e=>({...e,supplierName:f[e.id]?.supplierName||e.supplierName,supplierReference:f[e.id]?.supplierReference||e.supplierReference,estimatedCost:f[e.id]?.estimatedCost||e.estimatedCost})),s={...n,items:e},r=await fetch(`/api/requests/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!r.ok)throw Error("Failed to update request");let a=await r.json();d(a),g(!0),setTimeout(()=>g(!1),3e3)}catch(e){u(e instanceof Error?e.message:"Failed to save changes")}finally{p(!1)}}},v=async()=>{if(n&&confirm("Are you sure you want to send this request for approval? You won't be able to make further changes.")){p(!0);try{let e={...n,status:"waiting_for_approval",items:n.items.map(e=>({...e,supplierName:f[e.id]?.supplierName||e.supplierName,supplierReference:f[e.id]?.supplierReference||e.supplierReference,estimatedCost:f[e.id]?.estimatedCost||e.estimatedCost}))};if(!(await fetch(`/api/requests/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to send for approval");s.push("/purchaser")}catch(e){u(e instanceof Error?e.message:"Failed to send for approval")}finally{p(!1)}}},w=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};if(o)return r.jsx("div",{className:"space-y-6",children:(0,r.jsxs)("div",{className:"animate-pulse",children:[r.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[r.jsx("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),r.jsx("div",{className:"h-32 bg-gray-200 rounded"})]})]})});if(m)return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Process Request"}),r.jsx(l.default,{href:"/purchaser",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Portal"})]}),r.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsxs)("div",{className:"ml-3",children:[r.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error loading request"}),r.jsx("p",{className:"text-sm text-red-700 mt-1",children:m})]})]})})]});if(!n)return null;let P="requested"===n.status||"waiting_for_approval"===n.status,C=n.items.reduce((e,s,t)=>{let r=s.id,a=f[r]?.estimatedCost||s.estimatedCost;return e+("number"==typeof a?a:parseFloat(a.toString())||0)},0);return(0,r.jsxs)("div",{className:"space-y-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Process Request"}),(0,r.jsxs)("p",{className:"text-gray-600",children:["Request ID: ",n.id]})]}),(0,r.jsxs)("div",{className:"flex space-x-3",children:[r.jsx(l.default,{href:"/purchaser",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Portal"}),P&&(0,r.jsxs)(r.Fragment,{children:[r.jsx("button",{onClick:N,disabled:x,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:x?"Saving...":"Save Changes"}),r.jsx("button",{onClick:v,disabled:x,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors disabled:opacity-50",children:"Send for Approval"})]})]})]}),h&&r.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),r.jsx("div",{className:"ml-3",children:r.jsx("p",{className:"text-sm text-green-800",children:"Changes saved successfully!"})})]})}),r.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Requester"}),(0,r.jsxs)("div",{className:"mt-1",children:[r.jsx("div",{className:"text-sm text-gray-900",children:n.requesterName.split("@")[0]}),(0,r.jsxs)("div",{className:"text-xs text-gray-500",children:["@",n.requesterName.split("@")[1]]})]})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Status"}),r.jsx("span",{className:`mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full ${(e=>{switch(e){case"requested":return"bg-blue-100 text-blue-800";case"waiting_for_approval":return"bg-yellow-100 text-yellow-800";case"approval_completed":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(n.status)}`,style:{whiteSpace:"pre-line",textAlign:"center"},children:"waiting_for_approval"===n.status?"Waiting for\nApproval":n.status.replace("_"," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Date Submitted"}),r.jsx("p",{className:"mt-1 text-sm text-gray-900",children:new Date(n.requestDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,r.jsxs)("div",{children:[r.jsx("h3",{className:"text-sm font-medium text-gray-500",children:"Total Est. Cost"}),(0,r.jsxs)("p",{className:"mt-1 text-sm font-semibold text-gray-900",children:["€",C.toFixed(2)]})]})]})}),(0,r.jsxs)("div",{className:"space-y-6",children:[r.jsx("h3",{className:"text-lg font-medium text-gray-900",children:"Process Items"}),n.items.map((e,s)=>{let t=f[e.id]||{supplierName:e.supplierName||"",supplierReference:e.supplierReference||"",estimatedCost:e.estimatedCost||"",attachments:[]};return(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[r.jsx("div",{className:"flex justify-between items-start mb-6",children:(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"text-base font-medium text-gray-900 mb-2",children:["Item ",s+1,": ",e.itemName]}),(0,r.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,r.jsxs)("span",{children:["Qty: ",e.quantity]}),r.jsx("span",{className:`px-2 py-1 text-xs font-semibold rounded-full ${w(e.priority)}`,children:e.priority}),e.neededByDate&&(0,r.jsxs)("span",{children:["Needed by: ",new Date(e.neededByDate).toLocaleDateString()]})]})]})}),(0,r.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[r.jsx("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Original Request"}),r.jsx("p",{className:"text-sm text-gray-600",children:e.justification}),e.supplierName&&(0,r.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[r.jsx("span",{className:"font-medium",children:"Original Supplier:"})," ",e.supplierName]})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Name"}),r.jsx("input",{type:"text",value:t.supplierName,onChange:s=>y(e.id,"supplierName",s.target.value),disabled:!P,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"Enter supplier name"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Reference/Link"}),r.jsx("input",{type:"text",value:t.supplierReference,onChange:s=>y(e.id,"supplierReference",s.target.value),disabled:!P,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"Part number, URL, or reference"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Actual Cost (€)"}),r.jsx("input",{type:"number",min:"0",step:"0.01",value:t.estimatedCost,onChange:s=>y(e.id,"estimatedCost",s.target.value?Number(s.target.value):""),disabled:!P,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"0.00"})]}),(0,r.jsxs)("div",{children:[r.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Documentation (PDF/Images)"}),r.jsx("input",{type:"file",multiple:!0,accept:".pdf,image/*",onChange:s=>j(e.id,s.target.files),disabled:!P,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"PDF or image files, max 10MB each"}),t.attachments&&t.attachments.length>0&&(0,r.jsxs)("div",{className:"mt-2",children:[r.jsx("p",{className:"text-xs font-medium text-gray-700",children:"Selected files:"}),r.jsx("ul",{className:"text-xs text-gray-600",children:t.attachments.map((e,s)=>(0,r.jsxs)("li",{children:[e.name," (",(e.size/1024/1024).toFixed(1),"MB)"]},s))})]})]})]})]},e.id)})]}),!P&&r.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,r.jsxs)("div",{className:"flex",children:[r.jsx("svg",{className:"w-5 h-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("div",{className:"ml-3",children:(0,r.jsxs)("p",{className:"text-sm text-yellow-800",children:["This request has been ","approval_completed"===n.status?"approved":"rejected"," and cannot be modified."]})})]})})]})}},579:(e,s,t)=>{"use strict";t.d(s,{default:()=>n});var r=t(326),a=t(7577),i=t(5047),l=t(434);function n({children:e}){let[s,t]=(0,a.useState)(null),[n,d]=(0,a.useState)(!0),o=(0,i.useRouter)(),c=(0,i.usePathname)(),m=["/login"].includes(c),u=async()=>{try{await fetch("/api/auth/logout",{method:"POST"}),t(null),o.push("/login?message=logged-out")}catch(e){}};return n&&!m?r.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,r.jsxs)("div",{className:"text-center",children:[r.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-4 text-gray-600",children:"Loading..."})]})}):m||!s?r.jsx("div",{className:"min-h-screen bg-gray-50",children:e}):(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx("header",{className:"bg-white shadow-sm border-b",children:r.jsx("div",{className:"max-w-4xl mx-auto px-4 py-4",children:(0,r.jsxs)("div",{className:"flex justify-between items-center",children:[r.jsx(l.default,{href:(e=>{switch(e){case"ceo":case"purchaser":return"/requests";default:return"/"}})(s.role),className:"text-2xl font-semibold text-gray-900 hover:text-gray-700",children:"Procurement System"}),(0,r.jsxs)("div",{className:"flex items-center space-x-4",children:[r.jsx("nav",{className:"flex space-x-4",children:(s?[{href:"/requests",label:"All Requests"}]:[]).map(e=>r.jsx(l.default,{href:e.href,className:`px-3 py-2 text-sm font-medium ${c===e.href?"text-blue-600 bg-blue-50 rounded-md":"text-gray-600 hover:text-gray-900"}`,children:e.label},e.href))}),(0,r.jsxs)("div",{className:"flex items-center space-x-3 border-l pl-4",children:[(0,r.jsxs)("div",{className:"text-sm",children:[r.jsx("p",{className:"font-medium text-gray-900",children:s.name}),r.jsx("p",{className:"text-gray-500 capitalize",children:s.role})]}),r.jsx("button",{onClick:u,className:"text-sm text-gray-600 hover:text-gray-900 font-medium",children:"Logout"})]})]})]})})}),r.jsx("main",{className:"max-w-4xl mx-auto px-4 py-8",children:e})]})}},9561:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>l,metadata:()=>i});var r=t(9510);let a=(0,t(8570).createProxy)(String.raw`C:\Users\Naam\Documents\Procurement_App\components\AuthenticatedLayout.tsx#default`);t(7272);let i={title:"Procurement App",description:"Digital procurement request system for engineering teams"};function l({children:e}){return r.jsx("html",{lang:"en",children:r.jsx("body",{className:"antialiased",children:r.jsx(a,{children:e})})})}},3854:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});let r=(0,t(8570).createProxy)(String.raw`C:\Users\Naam\Documents\Procurement_App\app\purchaser\requests\[id]\page.tsx#default`)},7272:()=>{}};var s=require("../../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),r=s.X(0,[276,982],()=>t(3137));module.exports=r})();