(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[608],{3386:function(e,t,r){Promise.resolve().then(r.bind(r,5766))},5766:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return i}});var s=r(7437),a=r(2265),l=r(7648);function i(){let[e,t]=(0,a.useState)([]),[r,i]=(0,a.useState)(null),[n,d]=(0,a.useState)(!0),[o,c]=(0,a.useState)(null),[u,x]=(0,a.useState)("all");(0,a.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(!e.ok)throw Error("Authentication required");let r=await e.json();i(r);let s=await fetch("/api/requests");if(!s.ok)throw Error("Failed to fetch requests");let a=await s.json();t(a)}catch(e){c(e instanceof Error?e.message:"Failed to load data")}finally{d(!1)}})()},[]);let p=e=>{switch(e){case"requested":return"bg-blue-100 text-blue-800";case"waiting_for_approval":return"bg-yellow-100 text-yellow-800";case"approval_completed":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},m=e=>new Date(e).toLocaleDateString("en-US",{month:"short",day:"numeric"}),h=e.filter(e=>"all"===u||e.status===u),g={all:e.length,requested:e.filter(e=>"requested"===e.status).length,waiting_for_approval:e.filter(e=>"waiting_for_approval"===e.status).length,approval_completed:e.filter(e=>"approval_completed"===e.status).length,rejected:e.filter(e=>"rejected"===e.status).length};return n?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Requests"}),(0,s.jsx)("p",{className:"text-gray-600",children:"Loading procurement requests..."})]}),(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"animate-pulse space-y-4",children:[(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,s.jsx)("div",{className:"h-4 bg-gray-200 rounded w-5/6"})]})})]}):o?(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)("div",{children:(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:"All Requests"})}),(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsxs)("div",{className:"ml-3",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error loading requests"}),(0,s.jsx)("p",{className:"text-sm text-red-700 mt-1",children:o})]})]})})]}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-2",children:r&&"requester"===r.role?"My Requests":"All Requests"}),(0,s.jsx)("p",{className:"text-gray-600",children:(()=>{if(!r)return"View and manage procurement requests";switch(r.role){case"requester":return"View and manage your procurement requests";case"purchaser":return"Review and process procurement requests from all requesters";case"ceo":return"Review and approve procurement requests";default:return"View and manage procurement requests"}})()})]}),(0,s.jsx)(l.default,{href:"/",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"New Request"})]}),((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&(0,s.jsx)("div",{className:"bg-white rounded-lg shadow",children:(0,s.jsx)("div",{className:"border-b border-gray-200",children:(0,s.jsxs)("nav",{className:"flex space-x-8 px-6","aria-label":"Tabs",children:[(0,s.jsxs)("button",{onClick:()=>x("all"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("all"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["All (",g.all,")"]}),(0,s.jsxs)("button",{onClick:()=>x("requested"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("requested"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["New Requests (",g.requested,")"]}),(0,s.jsxs)("button",{onClick:()=>x("waiting_for_approval"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("waiting_for_approval"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Pending Approval (",g.waiting_for_approval,")"]}),(0,s.jsxs)("button",{onClick:()=>x("approval_completed"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("approval_completed"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Approved (",g.approval_completed,")"]}),(0,s.jsxs)("button",{onClick:()=>x("rejected"),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat("rejected"===u?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:["Rejected (",g.rejected,")"]})]})})}),0===h.length?(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"text-center py-8",children:[(0,s.jsx)("svg",{className:"w-12 h-12 text-gray-400 mx-auto mb-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),(0,s.jsx)("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:(null==r?void 0:r.role)==="requester"?"No requests yet":"all"===u?"No requests":"No ".concat(u.replace("_"," ")," requests")}),(0,s.jsx)("p",{className:"text-gray-600 mb-4",children:(null==r?void 0:r.role)==="requester"?"Get started by creating your first procurement request.":"all"===u?"No procurement requests have been submitted yet.":'No requests with "'.concat(u.replace("_"," "),'" status.')}),(null==r?void 0:r.role)==="requester"&&(0,s.jsx)(l.default,{href:"/",className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Create First Request"})]})}):(0,s.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,s.jsx)("div",{className:"overflow-x-auto",children:(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{className:"bg-gray-50",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-16",children:"ID"}),(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Justification/Project"}),((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-28",children:"Requester"}),((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Items"}),(0,s.jsx)("th",{className:"px-3 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-32",children:"Status"}),(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-20",children:"Date"}),(0,s.jsx)("th",{className:"px-3 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Actions"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:h.map(e=>{let t=e.items.length>0?e.items[0].justification:"No justification provided",a=e.items.reduce((e,t)=>e+("number"==typeof t.estimatedCost?t.estimatedCost:0),0);return(0,s.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,s.jsx)("td",{className:"px-3 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:e.id}),(0,s.jsx)("td",{className:"px-3 py-4 text-sm text-gray-900",children:(0,s.jsx)("div",{className:"max-w-xs",style:{whiteSpace:"normal",wordWrap:"break-word"},children:t})}),((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&(0,s.jsxs)("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-900",children:[(0,s.jsx)("div",{className:"truncate",title:e.requesterName,children:e.requesterName.split("@")[0]}),(0,s.jsxs)("div",{className:"text-xs text-gray-500 truncate",children:["@",e.requesterName.split("@")[1]]})]}),((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&(0,s.jsx)("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-900",children:(0,s.jsxs)("div",{children:[e.items.length," item",1!==e.items.length?"s":"",a>0&&(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:["~â‚¬",a.toFixed(2)]})]})}),(0,s.jsx)("td",{className:"px-3 py-4 text-center",children:(0,s.jsx)("span",{className:"inline-flex px-3 py-1 text-xs font-semibold rounded-full ".concat(p(e.status)," min-w-20"),style:{whiteSpace:"pre-line",textAlign:"center"},children:"waiting_for_approval"===e.status?"Waiting for\nApproval":e.status.replace("_"," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})}),(0,s.jsx)("td",{className:"px-3 py-4 whitespace-nowrap text-sm text-gray-900",children:m(e.requestDate)}),(0,s.jsx)("td",{className:"px-3 py-4 whitespace-nowrap text-sm",children:(0,s.jsx)(l.default,{href:"/requests/".concat(e.id),className:"text-blue-600 hover:text-blue-800 font-medium",children:((null==r?void 0:r.role)==="purchaser"||(null==r?void 0:r.role)==="ceo")&&("requested"===e.status||"waiting_for_approval"===e.status)?"Process Request":"View Details"})})]},e.id)})})]})})})]})}}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=3386)}),_N_E=e.O()}]);