(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[182],{5414:function(e,s,t){Promise.resolve().then(t.bind(t,5462))},5462:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(7437),r=t(2265),i=t(9376),l=t(7648);function n(){let e=(0,i.useParams)(),s=(0,i.useRouter)(),t=e.id,[n,d]=(0,r.useState)(null),[o,c]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null),[p,x]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!1),[f,b]=(0,r.useState)({});(0,r.useEffect)(()=>{let e=async()=>{try{let e=await fetch("/api/requests/".concat(t));if(!e.ok){if(404===e.status)m("Request not found");else throw Error("Failed to fetch request");return}let s=await e.json();d(s);let a={};s.items.forEach(e=>{a[e.id]={supplierName:e.supplierName||"",supplierReference:e.supplierReference||"",estimatedCost:e.estimatedCost||"",attachments:[]}}),b(a)}catch(e){m(e instanceof Error?e.message:"Failed to load request")}finally{c(!1)}};t&&e()},[t]);let y=(e,s,t)=>{b(a=>({...a,[e]:{...a[e],[s]:t}}))},j=(e,s)=>{s&&y(e,"attachments",Array.from(s).filter(e=>{let s="application/pdf"===e.type||e.type.startsWith("image/"),t=e.size<=10485760;return s&&t}))},v=async()=>{if(n){x(!0),g(!1);try{let e=n.items.map(e=>{var s,t,a;return{...e,supplierName:(null===(s=f[e.id])||void 0===s?void 0:s.supplierName)||e.supplierName,supplierReference:(null===(t=f[e.id])||void 0===t?void 0:t.supplierReference)||e.supplierReference,estimatedCost:(null===(a=f[e.id])||void 0===a?void 0:a.estimatedCost)||e.estimatedCost}}),s={...n,items:e},a=await fetch("/api/requests/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});if(!a.ok)throw Error("Failed to update request");let r=await a.json();d(r),g(!0),setTimeout(()=>g(!1),3e3)}catch(e){m(e instanceof Error?e.message:"Failed to save changes")}finally{x(!1)}}},N=async()=>{if(n&&confirm("Are you sure you want to send this request for approval? You won't be able to make further changes.")){x(!0);try{let e={...n,status:"waiting_for_approval",items:n.items.map(e=>{var s,t,a;return{...e,supplierName:(null===(s=f[e.id])||void 0===s?void 0:s.supplierName)||e.supplierName,supplierReference:(null===(t=f[e.id])||void 0===t?void 0:t.supplierReference)||e.supplierReference,estimatedCost:(null===(a=f[e.id])||void 0===a?void 0:a.estimatedCost)||e.estimatedCost}})};if(!(await fetch("/api/requests/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Failed to send for approval");s.push("/purchaser")}catch(e){m(e instanceof Error?e.message:"Failed to send for approval")}finally{x(!1)}}},w=e=>{switch(e){case"urgent":return"bg-red-100 text-red-800";case"medium":return"bg-yellow-100 text-yellow-800";case"low":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};if(o)return(0,a.jsx)("div",{className:"space-y-6",children:(0,a.jsxs)("div",{className:"animate-pulse",children:[(0,a.jsx)("div",{className:"h-8 bg-gray-200 rounded w-1/3 mb-4"}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6 space-y-4",children:[(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-3/4"}),(0,a.jsx)("div",{className:"h-4 bg-gray-200 rounded w-1/2"}),(0,a.jsx)("div",{className:"h-32 bg-gray-200 rounded"})]})]})});if(u)return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Process Request"}),(0,a.jsx)(l.default,{href:"/purchaser",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Portal"})]}),(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-6",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsxs)("div",{className:"ml-3",children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-red-800",children:"Error loading request"}),(0,a.jsx)("p",{className:"text-sm text-red-700 mt-1",children:u})]})]})})]});if(!n)return null;let C="requested"===n.status||"waiting_for_approval"===n.status,k=n.items.reduce((e,s,t)=>{var a;let r=(null===(a=f[s.id])||void 0===a?void 0:a.estimatedCost)||s.estimatedCost;return e+("number"==typeof r?r:parseFloat(r.toString())||0)},0);return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900",children:"Process Request"}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Request ID: ",n.id]})]}),(0,a.jsxs)("div",{className:"flex space-x-3",children:[(0,a.jsx)(l.default,{href:"/purchaser",className:"bg-gray-600 text-white px-4 py-2 rounded-md hover:bg-gray-700 transition-colors",children:"Back to Portal"}),C&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:v,disabled:p,className:"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50",children:p?"Saving...":"Save Changes"}),(0,a.jsx)("button",{onClick:N,disabled:p,className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 transition-colors disabled:opacity-50",children:"Send for Approval"})]})]})]}),h&&(0,a.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-green-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsx)("p",{className:"text-sm text-green-800",children:"Changes saved successfully!"})})]})}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Requester"}),(0,a.jsxs)("div",{className:"mt-1",children:[(0,a.jsx)("div",{className:"text-sm text-gray-900",children:n.requesterName.split("@")[0]}),(0,a.jsxs)("div",{className:"text-xs text-gray-500",children:["@",n.requesterName.split("@")[1]]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Status"}),(0,a.jsx)("span",{className:"mt-1 inline-flex px-2 py-1 text-xs font-semibold rounded-full ".concat((e=>{switch(e){case"requested":return"bg-blue-100 text-blue-800";case"waiting_for_approval":return"bg-yellow-100 text-yellow-800";case"approval_completed":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}})(n.status)),style:{whiteSpace:"pre-line",textAlign:"center"},children:"waiting_for_approval"===n.status?"Waiting for\nApproval":n.status.replace("_"," ").split(" ").map(e=>e.charAt(0).toUpperCase()+e.slice(1)).join(" ")})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Date Submitted"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-gray-900",children:new Date(n.requestDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"})})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"Total Est. Cost"}),(0,a.jsxs)("p",{className:"mt-1 text-sm font-semibold text-gray-900",children:["€",k.toFixed(2)]})]})]})}),(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("h3",{className:"text-lg font-medium text-gray-900",children:"Process Items"}),n.items.map((e,s)=>{let t=f[e.id]||{supplierName:e.supplierName||"",supplierReference:e.supplierReference||"",estimatedCost:e.estimatedCost||"",attachments:[]};return(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-6",children:[(0,a.jsx)("div",{className:"flex justify-between items-start mb-6",children:(0,a.jsxs)("div",{children:[(0,a.jsxs)("h4",{className:"text-base font-medium text-gray-900 mb-2",children:["Item ",s+1,": ",e.itemName]}),(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-sm text-gray-500",children:[(0,a.jsxs)("span",{children:["Qty: ",e.quantity]}),(0,a.jsx)("span",{className:"px-2 py-1 text-xs font-semibold rounded-full ".concat(w(e.priority)),children:e.priority}),e.neededByDate&&(0,a.jsxs)("span",{children:["Needed by: ",new Date(e.neededByDate).toLocaleDateString()]})]})]})}),(0,a.jsxs)("div",{className:"mb-6 p-4 bg-gray-50 rounded-lg",children:[(0,a.jsx)("h5",{className:"text-sm font-medium text-gray-700 mb-2",children:"Original Request"}),(0,a.jsx)("p",{className:"text-sm text-gray-600",children:e.justification}),e.supplierName&&(0,a.jsxs)("p",{className:"text-sm text-gray-600 mt-1",children:[(0,a.jsx)("span",{className:"font-medium",children:"Original Supplier:"})," ",e.supplierName]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Name"}),(0,a.jsx)("input",{type:"text",value:t.supplierName,onChange:s=>y(e.id,"supplierName",s.target.value),disabled:!C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"Enter supplier name"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Reference/Link"}),(0,a.jsx)("input",{type:"text",value:t.supplierReference,onChange:s=>y(e.id,"supplierReference",s.target.value),disabled:!C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"Part number, URL, or reference"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Actual Cost (€)"}),(0,a.jsx)("input",{type:"number",min:"0",step:"0.01",value:t.estimatedCost,onChange:s=>y(e.id,"estimatedCost",s.target.value?Number(s.target.value):""),disabled:!C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100",placeholder:"0.00"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Price Documentation (PDF/Images)"}),(0,a.jsx)("input",{type:"file",multiple:!0,accept:".pdf,image/*",onChange:s=>j(e.id,s.target.files),disabled:!C,className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 disabled:bg-gray-100"}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"PDF or image files, max 10MB each"}),t.attachments&&t.attachments.length>0&&(0,a.jsxs)("div",{className:"mt-2",children:[(0,a.jsx)("p",{className:"text-xs font-medium text-gray-700",children:"Selected files:"}),(0,a.jsx)("ul",{className:"text-xs text-gray-600",children:t.attachments.map((e,s)=>(0,a.jsxs)("li",{children:[e.name," (",(e.size/1024/1024).toFixed(1),"MB)"]},s))})]})]})]})]},e.id)})]}),!C&&(0,a.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,a.jsxs)("div",{className:"flex",children:[(0,a.jsx)("svg",{className:"w-5 h-5 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,a.jsx)("div",{className:"ml-3",children:(0,a.jsxs)("p",{className:"text-sm text-yellow-800",children:["This request has been ","approval_completed"===n.status?"approved":"rejected"," and cannot be modified."]})})]})})]})}},9376:function(e,s,t){"use strict";var a=t(5475);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})}},function(e){e.O(0,[648,971,117,744],function(){return e(e.s=5414)}),_N_E=e.O()}]);