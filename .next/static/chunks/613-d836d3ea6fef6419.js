"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{1613:function(e,t,r){r.d(t,{Z:function(){return f}});var s=r(7437),i=r(2265);let l=e=>e.trim()?e.length<2?"Item name must be at least 2 characters":void 0:"Item name is required",a=e=>{if(""===e||null==e)return"Quantity is required";let t=Number(e);if(isNaN(t)||t<=0)return"Quantity must be a positive number"},n=e=>e.trim()?e.length<10?"Please provide a detailed justification (at least 10 characters)":void 0:"Justification is required",o=e=>{if(e&&e.trim()&&e.includes("http")&&!b(e))return"Please enter a valid URL or reference"},d=e=>{if(""!==e&&null!=e){let t=Number(e);if(isNaN(t)||t<0)return"Cost must be a positive number"}},u=e=>{if(!e||!["urgent","medium","low"].includes(e))return"Priority is required"},c=e=>{if(e&&e.trim()){let t=new Date(e),r=new Date;if(r.setHours(0,0,0,0),isNaN(t.getTime()))return"Please enter a valid date";if(t<r)return"Needed by date cannot be in the past"}},m=e=>({itemName:l(e.itemName),quantity:a(e.quantity),justification:n(e.justification),supplierReference:o(e.supplierReference),estimatedCost:d(e.estimatedCost),priority:u(e.priority),neededByDate:c(e.neededByDate)}),p=e=>{let t={};return e.forEach(e=>{let r=m(e);Object.values(r).some(e=>void 0!==e)&&(t[e.id]=r)}),t},x=e=>Object.keys(e).length>0,b=e=>{try{return new URL(e),!0}catch(e){return!1}},h=e=>({id:e,itemName:"",quantity:"",justification:"",supplierName:"",supplierReference:"",estimatedCost:"",priority:"",neededByDate:""});function f(e){let{onSubmit:t,initialData:r,isEditing:l=!1}=e,[a,n]=(0,i.useState)((null==r?void 0:r.items)||[h("item-1")]),[o,d]=(0,i.useState)({}),[u,c]=(0,i.useState)(!1),[m,b]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{console.log("\uD83D\uDD0D RequestForm: Fetching current user...");let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();console.log("✅ RequestForm: User fetched successfully:",t.email,"Role:",t.role),b(t)}else console.error("❌ RequestForm: Failed to fetch user, status:",e.status)}catch(e){console.error("❌ RequestForm: Error fetching current user:",e)}})()},[]);let[f,g]=(0,i.useState)(!1),[v,y]=(0,i.useState)(null),N=()=>"item-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),j=(0,i.useCallback)(()=>{let e=h(N());n(t=>[...t,e])},[]),w=(0,i.useCallback)(e=>{a.length>1&&(n(t=>t.filter(t=>t.id!==e)),d(t=>{let r={...t};return delete r[e],r}))},[a.length]),C=(0,i.useCallback)((e,t,r)=>{n(s=>s.map(s=>s.id===e?{...s,[t]:r}:s)),d(r=>{let s=r[e];if(s&&s[t]){let i={...s};delete i[t];let l=Object.values(i).some(e=>void 0!==e),a={...r};return l?a[e]=i:delete a[e],a}return r})},[]),q=(0,i.useCallback)(()=>{let e=p(a);return d(e),!x(e)},[a]),D=async e=>{if(e.preventDefault(),q()){g(!0),y(null);try{console.log("\uD83D\uDCDD RequestForm: Form submission started"),console.log("\uD83D\uDC64 RequestForm: Current user at submit:",(null==m?void 0:m.email)||"NO USER LOADED");let e={id:(null==r?void 0:r.id)||"req-".concat(Date.now()),requesterName:(null==r?void 0:r.requesterName)||(null==m?void 0:m.email)||"Unknown User",requestDate:(null==r?void 0:r.requestDate)||new Date().toISOString(),items:a.map(e=>({...e,quantity:Number(e.quantity)||0,estimatedCost:e.estimatedCost?Number(e.estimatedCost):0,priority:e.priority})),status:(null==r?void 0:r.status)||"requested"};console.log("\uD83D\uDCE6 RequestForm: Request object created:",{id:e.id,requesterName:e.requesterName,status:e.status,itemCount:e.items.length}),t&&(console.log("\uD83D\uDE80 RequestForm: Calling onSubmit..."),await t(e),console.log("✅ RequestForm: onSubmit completed successfully")),c(!0)}catch(e){y(e instanceof Error?e.message:"Failed to submit request")}finally{g(!1)}}};return u?(0,s.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"text-center",children:[(0,s.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center",children:(0,s.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,s.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l?"Request Updated Successfully":"Request Submitted Successfully"}),(0,s.jsx)("p",{className:"text-gray-600 mb-6",children:l?"Your procurement request has been updated successfully.":"Your procurement request has been submitted and is now waiting for approval."}),(0,s.jsx)("button",{onClick:()=>{c(!1),n([h(N())]),d({}),y(null)},className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Submit Another Request"})]})}):(0,s.jsx)("form",{onSubmit:D,className:"bg-white rounded-lg shadow p-6",children:(0,s.jsxs)("div",{className:"space-y-8",children:[a.map((e,t)=>{var r,i,l,n,d,u,c,m,p,x,b,h,f,g;return(0,s.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Item ",t+1]}),a.length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>w(e.id),className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Remove Item"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Name / Description *"}),(0,s.jsx)("input",{type:"text",value:e.itemName,onChange:t=>C(e.id,"itemName",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(r=o[e.id])||void 0===r?void 0:r.itemName)?"border-red-500":"border-gray-300"),placeholder:"Enter item name or description"}),(null===(i=o[e.id])||void 0===i?void 0:i.itemName)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].itemName})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),(0,s.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>C(e.id,"quantity",t.target.value?Number(t.target.value):""),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(l=o[e.id])||void 0===l?void 0:l.quantity)?"border-red-500":"border-gray-300"),placeholder:"0"}),(null===(n=o[e.id])||void 0===n?void 0:n.quantity)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].quantity})]}),(0,s.jsxs)("div",{className:"md:col-span-2",children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justification / Reason *"}),(0,s.jsx)("textarea",{value:e.justification,onChange:t=>C(e.id,"justification",t.target.value),rows:3,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(d=o[e.id])||void 0===d?void 0:d.justification)?"border-red-500":"border-gray-300"),placeholder:"Explain why this item is needed"}),(null===(u=o[e.id])||void 0===u?void 0:u.justification)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].justification})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Name"}),(0,s.jsx)("input",{type:"text",value:e.supplierName,onChange:t=>C(e.id,"supplierName",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter supplier name"})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Reference / Link"}),(0,s.jsx)("input",{type:"text",value:e.supplierReference,onChange:t=>C(e.id,"supplierReference",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(c=o[e.id])||void 0===c?void 0:c.supplierReference)?"border-red-500":"border-gray-300"),placeholder:"Part number, URL, or reference"}),(null===(m=o[e.id])||void 0===m?void 0:m.supplierReference)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].supplierReference})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Cost"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-2 text-gray-500",children:"€"}),(0,s.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.estimatedCost,onChange:t=>C(e.id,"estimatedCost",t.target.value?Number(t.target.value):""),className:"w-full pl-8 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(p=o[e.id])||void 0===p?void 0:p.estimatedCost)?"border-red-500":"border-gray-300"),placeholder:"0.00"})]}),(null===(x=o[e.id])||void 0===x?void 0:x.estimatedCost)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].estimatedCost})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority *"}),(0,s.jsxs)("select",{value:e.priority,onChange:t=>C(e.id,"priority",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(b=o[e.id])||void 0===b?void 0:b.priority)?"border-red-500":"border-gray-300"),children:[(0,s.jsx)("option",{value:"",children:"Select priority"}),(0,s.jsx)("option",{value:"urgent",children:"Urgent"}),(0,s.jsx)("option",{value:"medium",children:"Medium"}),(0,s.jsx)("option",{value:"low",children:"Low"})]}),(null===(h=o[e.id])||void 0===h?void 0:h.priority)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].priority})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Needed By Date"}),(0,s.jsx)("input",{type:"date",value:e.neededByDate,onChange:t=>C(e.id,"neededByDate",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(f=o[e.id])||void 0===f?void 0:f.neededByDate)?"border-red-500":"border-gray-300")}),(null===(g=o[e.id])||void 0===g?void 0:g.neededByDate)&&(0,s.jsx)("p",{className:"mt-1 text-sm text-red-600",children:o[e.id].neededByDate})]})]})]},e.id)}),(0,s.jsx)("div",{className:"flex justify-center",children:(0,s.jsx)("button",{type:"button",onClick:j,className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-200 transition-colors border border-gray-300",children:"+ Add Item"})}),v&&(0,s.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,s.jsxs)("div",{className:"flex",children:[(0,s.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,s.jsx)("div",{className:"ml-3",children:(0,s.jsx)("p",{className:"text-sm text-red-800",children:v})})]})}),(0,s.jsx)("div",{className:"flex justify-end pt-6 border-t",children:(0,s.jsxs)("button",{type:"submit",disabled:f,className:"bg-blue-600 text-white px-8 py-3 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[f&&(0,s.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,s.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,s.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),f?"Submitting...":"Submit Request"]})})]})})}}}]);