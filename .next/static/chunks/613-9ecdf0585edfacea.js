"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{1613:function(e,t,i){i.d(t,{Z:function(){return f}});var r=i(7437),s=i(2265);let l=e=>e.trim()?e.length<2?"Item name must be at least 2 characters":void 0:"Item name is required",a=e=>{if(""===e||null==e)return"Quantity is required";let t=Number(e);if(isNaN(t)||t<=0)return"Quantity must be a positive number"},n=e=>e.trim()?e.length<10?"Please provide a detailed justification (at least 10 characters)":void 0:"Justification is required",d=e=>{if(e&&e.trim()&&e.includes("http")&&!b(e))return"Please enter a valid URL or reference"},o=e=>{if(""!==e&&null!=e){let t=Number(e);if(isNaN(t)||t<0)return"Cost must be a positive number"}},u=e=>{if(!e||!["urgent","medium","low"].includes(e))return"Priority is required"},c=e=>{if(e&&e.trim()){let t=new Date(e),i=new Date;if(i.setHours(0,0,0,0),isNaN(t.getTime()))return"Please enter a valid date";if(t<i)return"Needed by date cannot be in the past"}},m=e=>({itemName:l(e.itemName),quantity:a(e.quantity),justification:n(e.justification),supplierReference:d(e.supplierReference),estimatedCost:o(e.estimatedCost),priority:u(e.priority),neededByDate:c(e.neededByDate)}),p=e=>{let t={};return e.forEach(e=>{let i=m(e);Object.values(i).some(e=>void 0!==e)&&(t[e.id]=i)}),t},x=e=>Object.keys(e).length>0,b=e=>{try{return new URL(e),!0}catch(e){return!1}},h=e=>({id:e,itemName:"",quantity:"",justification:"",supplierName:"",supplierReference:"",estimatedCost:"",priority:"",neededByDate:""});function f(e){let{onSubmit:t,initialData:i,isEditing:l=!1}=e,[a,n]=(0,s.useState)((null==i?void 0:i.items)||[h("item-1")]),[d,o]=(0,s.useState)({}),[u,c]=(0,s.useState)(!1),[m,b]=(0,s.useState)(null);(0,s.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/auth/me");if(e.ok){let t=await e.json();b(t)}}catch(e){console.error("Failed to fetch current user:",e)}})()},[]);let[f,v]=(0,s.useState)(!1),[y,g]=(0,s.useState)(null),j=()=>"item-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),N=(0,s.useCallback)(()=>{let e=h(j());n(t=>[...t,e])},[]),w=(0,s.useCallback)(e=>{a.length>1&&(n(t=>t.filter(t=>t.id!==e)),o(t=>{let i={...t};return delete i[e],i}))},[a.length]),C=(0,s.useCallback)((e,t,i)=>{n(r=>r.map(r=>r.id===e?{...r,[t]:i}:r)),o(i=>{let r=i[e];if(r&&r[t]){let s={...r};delete s[t];let l=Object.values(s).some(e=>void 0!==e),a={...i};return l?a[e]=s:delete a[e],a}return i})},[]),k=(0,s.useCallback)(()=>{let e=p(a);return o(e),!x(e)},[a]),q=async e=>{if(e.preventDefault(),k()){v(!0),g(null);try{let e={id:(null==i?void 0:i.id)||"req-".concat(Date.now()),requesterName:(null==i?void 0:i.requesterName)||(null==m?void 0:m.email)||"Unknown User",requestDate:(null==i?void 0:i.requestDate)||new Date().toISOString(),items:a.map(e=>({...e,quantity:Number(e.quantity)||0,estimatedCost:e.estimatedCost?Number(e.estimatedCost):0,priority:e.priority})),status:(null==i?void 0:i.status)||"requested"};t&&await t(e),c(!0)}catch(e){g(e instanceof Error?e.message:"Failed to submit request")}finally{v(!1)}}};return u?(0,r.jsx)("div",{className:"bg-white rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"text-center",children:[(0,r.jsx)("div",{className:"w-16 h-16 mx-auto mb-4 bg-green-100 rounded-full flex items-center justify-center",children:(0,r.jsx)("svg",{className:"w-8 h-8 text-green-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M5 13l4 4L19 7"})})}),(0,r.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:l?"Request Updated Successfully":"Request Submitted Successfully"}),(0,r.jsx)("p",{className:"text-gray-600 mb-6",children:l?"Your procurement request has been updated successfully.":"Your procurement request has been submitted and is now waiting for approval."}),(0,r.jsx)("button",{onClick:()=>{c(!1),n([h(j())]),o({}),g(null)},className:"bg-blue-600 text-white px-6 py-2 rounded-md hover:bg-blue-700 transition-colors",children:"Submit Another Request"})]})}):(0,r.jsx)("form",{onSubmit:q,className:"bg-white rounded-lg shadow p-6",children:(0,r.jsxs)("div",{className:"space-y-8",children:[a.map((e,t)=>{var i,s,l,n,o,u,c,m,p,x,b,h,f,v;return(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg p-6",children:[(0,r.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,r.jsxs)("h3",{className:"text-lg font-semibold text-gray-900",children:["Item ",t+1]}),a.length>1&&(0,r.jsx)("button",{type:"button",onClick:()=>w(e.id),className:"text-red-600 hover:text-red-700 text-sm font-medium",children:"Remove Item"})]}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Item Name / Description *"}),(0,r.jsx)("input",{type:"text",value:e.itemName,onChange:t=>C(e.id,"itemName",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(i=d[e.id])||void 0===i?void 0:i.itemName)?"border-red-500":"border-gray-300"),placeholder:"Enter item name or description"}),(null===(s=d[e.id])||void 0===s?void 0:s.itemName)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].itemName})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Quantity *"}),(0,r.jsx)("input",{type:"number",min:"1",value:e.quantity,onChange:t=>C(e.id,"quantity",t.target.value?Number(t.target.value):""),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(l=d[e.id])||void 0===l?void 0:l.quantity)?"border-red-500":"border-gray-300"),placeholder:"0"}),(null===(n=d[e.id])||void 0===n?void 0:n.quantity)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].quantity})]}),(0,r.jsxs)("div",{className:"md:col-span-2",children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Justification / Reason *"}),(0,r.jsx)("textarea",{value:e.justification,onChange:t=>C(e.id,"justification",t.target.value),rows:3,className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(o=d[e.id])||void 0===o?void 0:o.justification)?"border-red-500":"border-gray-300"),placeholder:"Explain why this item is needed"}),(null===(u=d[e.id])||void 0===u?void 0:u.justification)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].justification})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Name"}),(0,r.jsx)("input",{type:"text",value:e.supplierName,onChange:t=>C(e.id,"supplierName",t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"Enter supplier name"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Supplier Reference / Link"}),(0,r.jsx)("input",{type:"text",value:e.supplierReference,onChange:t=>C(e.id,"supplierReference",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(c=d[e.id])||void 0===c?void 0:c.supplierReference)?"border-red-500":"border-gray-300"),placeholder:"Part number, URL, or reference"}),(null===(m=d[e.id])||void 0===m?void 0:m.supplierReference)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].supplierReference})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Estimated Cost"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-2 text-gray-500",children:"â‚¬"}),(0,r.jsx)("input",{type:"number",min:"0",step:"0.01",value:e.estimatedCost,onChange:t=>C(e.id,"estimatedCost",t.target.value?Number(t.target.value):""),className:"w-full pl-8 pr-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(p=d[e.id])||void 0===p?void 0:p.estimatedCost)?"border-red-500":"border-gray-300"),placeholder:"0.00"})]}),(null===(x=d[e.id])||void 0===x?void 0:x.estimatedCost)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].estimatedCost})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Priority *"}),(0,r.jsxs)("select",{value:e.priority,onChange:t=>C(e.id,"priority",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(b=d[e.id])||void 0===b?void 0:b.priority)?"border-red-500":"border-gray-300"),children:[(0,r.jsx)("option",{value:"",children:"Select priority"}),(0,r.jsx)("option",{value:"urgent",children:"Urgent"}),(0,r.jsx)("option",{value:"medium",children:"Medium"}),(0,r.jsx)("option",{value:"low",children:"Low"})]}),(null===(h=d[e.id])||void 0===h?void 0:h.priority)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].priority})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Needed By Date"}),(0,r.jsx)("input",{type:"date",value:e.neededByDate,onChange:t=>C(e.id,"neededByDate",t.target.value),className:"w-full px-3 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 ".concat((null===(f=d[e.id])||void 0===f?void 0:f.neededByDate)?"border-red-500":"border-gray-300")}),(null===(v=d[e.id])||void 0===v?void 0:v.neededByDate)&&(0,r.jsx)("p",{className:"mt-1 text-sm text-red-600",children:d[e.id].neededByDate})]})]})]},e.id)}),(0,r.jsx)("div",{className:"flex justify-center",children:(0,r.jsx)("button",{type:"button",onClick:N,className:"bg-gray-100 text-gray-700 px-6 py-2 rounded-md hover:bg-gray-200 transition-colors border border-gray-300",children:"+ Add Item"})}),y&&(0,r.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-md p-4",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("svg",{className:"w-5 h-5 text-red-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),(0,r.jsx)("div",{className:"ml-3",children:(0,r.jsx)("p",{className:"text-sm text-red-800",children:y})})]})}),(0,r.jsx)("div",{className:"flex justify-end pt-6 border-t",children:(0,r.jsxs)("button",{type:"submit",disabled:f,className:"bg-blue-600 text-white px-8 py-3 rounded-md hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center",children:[f&&(0,r.jsxs)("svg",{className:"animate-spin -ml-1 mr-3 h-5 w-5 text-white",fill:"none",viewBox:"0 0 24 24",children:[(0,r.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,r.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),f?"Submitting...":"Submit Request"]})})]})})}}}]);